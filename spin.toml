#:schema https://schemas.spinframework.dev/spin/manifest/v2/latest.json

spin_manifest_version = 2

[application]
name = "pocketsmith-proxy"
version = "0.1.0"
description = "PocketSmith API proxy with JSON-RPC interface"

[variables]
# For inbound requests to RPC endpoint
client_key = { required = true }
# For PocketSmith API access
pocketsmith_api_key = { required = true }
# Account IDs for different currencies
usd_account_id = { required = true }
ars_account_id = { required = true }
# Redis configuration
redis_address = { default = "redis://localhost:6379" }

[[trigger.http]]
route = "/api/v1/transactions/append"
component = "pocketsmith-rpc"

[component.pocketsmith-rpc]
source = "main.wasm"
allowed_outbound_hosts = ["https://api.pocketsmith.com", "redis://localhost:6379"]

[component.pocketsmith-rpc.variables]
client_auth_key = "{{ client_key }}"
pocketsmith_api_key = "{{ pocketsmith_api_key }}"
usd_account_id = "{{ usd_account_id }}"
ars_account_id = "{{ ars_account_id }}"
redis_address = "{{ redis_address }}"

[component.pocketsmith-rpc.build]
command = "tinygo build -target=wasip1 -gc=leaking -buildmode=c-shared -no-debug -o main.wasm ."
watch = ["**/*.go", "go.mod"]
