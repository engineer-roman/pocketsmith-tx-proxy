#:schema https://schemas.spinframework.dev/spin/manifest/v2/latest.json

spin_manifest_version = 2

[application]
name = "pocketsmith-proxy"
version = "0.1.0"
description = "PocketSmith API proxy with JSON-RPC interface"

[variables]
# For inbound requests to RPC endpoint
client_key = { required = true }
# For PocketSmith API access
pocketsmith_api_key = { required = true }

[[trigger.http]]
route = "/pocketsmith/api/v1/jsonrpc"
component = "pocketsmith-rpc"

[component.pocketsmith-rpc]
source = "main.wasm"
allowed_outbound_hosts = ["https://api.pocketsmith.com"]

[component.pocketsmith-rpc.variables]
client_auth_key = "{{ client_key }}"
pocketsmith_api_key = "{{ pocketsmith_api_key }}"

[component.pocketsmith-rpc.build]
command = "tinygo build -target=wasip1 -gc=leaking -buildmode=c-shared -no-debug -o main.wasm ."
watch = ["**/*.go", "go.mod"]
